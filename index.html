<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ¨çº¿ ZIP å‹ç¼©ä¸è§£å‹å·¥å…·</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 40px; background-color: #f8f9fa; }
        .card { margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .file-list { max-height: 200px; overflow-y: auto; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container" style="max-width: 800px;">
    <h1 class="text-center mb-4">ğŸ“‚ åœ¨çº¿ ZIP å·¥å…·</h1>
    <p class="text-center text-muted">æ‰€æœ‰æ–‡ä»¶å‡åœ¨æœ¬åœ°å¤„ç†ï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œè¯·æ”¾å¿ƒä½¿ç”¨ã€‚</p>

    <div class="card p-4">
        <h3>1. å‹ç¼©æ–‡ä»¶ (åˆ¶ä½œ Zip)</h3>
        <div class="mb-3">
            <label class="form-label">é€‰æ‹©å¤šä¸ªæ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼š</label>
            <input class="form-control" type="file" id="filesToZip" multiple>
        </div>
        <button class="btn btn-primary" onclick="compressFiles()">ğŸ“¦ ç”Ÿæˆå¹¶ä¸‹è½½ ZIP</button>
    </div>

    <div class="card p-4">
        <h3>2. è§£å‹æ–‡ä»¶ (è¯»å– Zip)</h3>
        <div class="mb-3">
            <label class="form-label">é€‰æ‹©ä¸€ä¸ª ZIP æ–‡ä»¶ï¼š</label>
            <input class="form-control" type="file" id="fileToUnzip" accept=".zip">
        </div>
        <button class="btn btn-success" onclick="decompressFile()">ğŸ”“ è¯»å– ZIP å†…å®¹</button>
        
        <div id="unzipResult" class="mt-3"></div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<script>
    // --- å‹ç¼©åŠŸèƒ½çš„é€»è¾‘ ---
    async function compressFiles() {
        const fileInput = document.getElementById('filesToZip');
        const files = fileInput.files;

        if (files.length === 0) {
            alert("è¯·å…ˆé€‰æ‹©è¦å‹ç¼©çš„æ–‡ä»¶ï¼");
            return;
        }

        const zip = new JSZip();

        // éå†æ‰€æœ‰é€‰ä¸­çš„æ–‡ä»¶ï¼Œæ·»åŠ åˆ° zip å¯¹è±¡ä¸­
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            // zip.file(æ–‡ä»¶å, æ–‡ä»¶å†…å®¹)
            zip.file(file.name, file);
        }

        // ç”Ÿæˆ zip æ–‡ä»¶æµ
        try {
            const content = await zip.generateAsync({type: "blob"});
            // è§¦å‘ä¸‹è½½
            saveAs(content, "compressed_files.zip");
        } catch (e) {
            console.error(e);
            alert("å‹ç¼©å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚");
        }
    }

    // --- è§£å‹åŠŸèƒ½çš„é€»è¾‘ ---
    async function decompressFile() {
        const fileInput = document.getElementById('fileToUnzip');
        const file = fileInput.files[0];
        const resultDiv = document.getElementById('unzipResult');
        resultDiv.innerHTML = ""; // æ¸…ç©ºä¹‹å‰çš„ç»“æœ

        if (!file) {
            alert("è¯·å…ˆé€‰æ‹©ä¸€ä¸ª ZIP æ–‡ä»¶ï¼");
            return;
        }

        try {
            const zip = new JSZip();
            // åŠ è½½ zip æ–‡ä»¶
            const zipContent = await zip.loadAsync(file);
            
            let listHtml = '<ul class="list-group file-list">';
            
            // éå† zip åŒ…å†…çš„æ–‡ä»¶
            zipContent.forEach(function (relativePath, zipEntry) {
                if (!zipEntry.dir) { // è¿™é‡Œæˆ‘ä»¬åªå¤„ç†æ–‡ä»¶ï¼Œå¿½ç•¥çº¯æ–‡ä»¶å¤¹æ¡ç›®
                     // ä¸ºæ¯ä¸ªæ–‡ä»¶åˆ›å»ºä¸€ä¸ªä¸‹è½½æŒ‰é’®çš„ID
                    const btnId = `btn-${Math.random().toString(36).substr(2, 9)}`;
                    listHtml += `
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            ${zipEntry.name}
                            <button class="btn btn-sm btn-outline-primary" 
                                onclick="downloadOneFile('${relativePath}')">ä¸‹è½½</button>
                        </li>`;
                }
            });
            
            listHtml += '</ul>';
            resultDiv.innerHTML = listHtml;
            
            // å°† zip å¯¹è±¡æŒ‚è½½åˆ° window ä»¥ä¾¿ downloadOneFile å‡½æ•°ä½¿ç”¨ï¼ˆç®€å•å®ç°ï¼‰
            window.currentZip = zip;

        } catch (e) {
            console.error(e);
            alert("è¿™ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ ZIP æ–‡ä»¶æˆ–æ–‡ä»¶å·²æŸåã€‚");
        }
    }

    // ä¸‹è½½è§£å‹åçš„å•ä¸ªæ–‡ä»¶
    async function downloadOneFile(filename) {
        if(!window.currentZip) return;
        const file = window.currentZip.file(filename);
        if(file) {
            const blob = await file.async("blob");
            saveAs(blob, filename.split('/').pop()); // å¤„ç†è·¯å¾„ï¼Œåªä¿ç•™æ–‡ä»¶å
        }
    }
</script>

</body>
</html>