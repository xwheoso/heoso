<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>极简 ZIP 工具 - 纯本地处理</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5', // 靛蓝色
                        secondary: '#10B981', // 翠绿色
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            /* 美化文件上传输入框的样式 */
            .custom-file-upload {
                @apply border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-primary transition duration-300 ease-in-out bg-gray-50 hover:bg-indigo-50;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-100 to-slate-200 min-h-screen py-12 font-sans text-gray-800">

<div class="container mx-auto px-4 max-w-5xl">
    <div class="text-center mb-12">
        <h1 class="text-4xl font-extrabold text-gray-900 mb-4">
            <i class="fa-solid fa-file-zipper text-primary mr-2"></i> 极简 ZIP 工具箱
        </h1>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto bg-white/50 py-2 px-4 rounded-full inline-block shadow-sm">
            <i class="fa-solid fa-shield-halved text-green-600 mr-1"></i> 
            安全声明：所有文件处理均在您的浏览器本地完成，<b>绝不会</b>上传至任何服务器。
        </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

        <div class="bg-white rounded-2xl shadow-xl overflow-hidden hover:shadow-2xl transition-shadow duration-300">
            <div class="bg-primary p-6">
                <h2 class="text-2xl font-bold text-white flex items-center">
                    <i class="fa-solid fa-box-archive mr-3"></i> 创建 ZIP 压缩包
                </h2>
                <p class="text-indigo-100 mt-2 text-sm">选择多个文件，打包成一个 ZIP 文件下载。</p>
            </div>
            <div class="p-8 space-y-6">
                <div>
                    <label for="filesToZip" class="block text-sm font-medium text-gray-700 mb-2">第一步：选择文件</label>
                    <label class="custom-file-upload flex flex-col items-center justify-center">
                        <i class="fa-solid fa-cloud-arrow-up text-4xl text-gray-400 mb-3"></i>
                        <span class="text-sm text-gray-600 font-medium">点击此处选择文件</span>
                        <span id="zipFileCount" class="text-xs text-gray-400 mt-1">(支持多选)</span>
                        <input id="filesToZip" type="file" multiple class="hidden" />
                    </label>
                </div>
                
                <button onclick="compressFiles()" class="w-full flex items-center justify-center py-3 px-6 border border-transparent rounded-lg shadow-sm text-lg font-medium text-white bg-gradient-to-r from-primary to-indigo-600 hover:from-indigo-600 hover:to-primary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-all duration-200 active:scale-[0.98]">
                    <i class="fa-solid fa-download mr-2"></i> 开始压缩并下载
                </button>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-xl overflow-hidden hover:shadow-2xl transition-shadow duration-300">
             <div class="bg-secondary p-6">
                <h2 class="text-2xl font-bold text-white flex items-center">
                    <i class="fa-solid fa-box-open mr-3"></i> 解压 ZIP 文件
                </h2>
                <p class="text-green-100 mt-2 text-sm">读取 ZIP 文件内容并单独下载内部文件。</p>
            </div>
            <div class="p-8 space-y-6">
                <div>
                    <label for="fileToUnzip" class="block text-sm font-medium text-gray-700 mb-2">第一步：选择 ZIP 文件</label>
                     <label class="custom-file-upload flex flex-col items-center justify-center relative">
                        <i class="fa-solid fa-file-zipper text-4xl text-gray-400 mb-3"></i>
                        <span class="text-sm text-gray-600 font-medium">点击选择 .zip 文件</span>
                        <span id="unzipFileName" class="text-xs text-gray-400 mt-1 truncate max-w-[250px]">(仅限一个文件)</span>
                        <input id="fileToUnzip" type="file" accept=".zip" class="hidden" />
                    </label>
                </div>

                <button onclick="decompressFile()" class="w-full flex items-center justify-center py-3 px-6 border border-transparent rounded-lg shadow-sm text-lg font-medium text-white bg-gradient-to-r from-secondary to-emerald-600 hover:from-emerald-600 hover:to-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary transition-all duration-200 active:scale-[0.98]">
                     <i class="fa-solid fa-magnifying-glass mr-2"></i> 读取文件列表
                </button>

                <div id="unzipResultWrapper" class="hidden mt-6">
                    <h3 class="text-sm font-bold text-gray-700 mb-3 flex items-center">
                        <i class="fa-solid fa-list-ul mr-2"></i> 文件列表：
                    </h3>
                    <div id="unzipResult" class="border rounded-lg bg-gray-50 max-h-64 overflow-y-auto p-2 divide-y divide-gray-200 shadow-inner">
                        </div>
                </div>
            </div>
        </div>

    </div>
    
    <div class="text-center text-gray-500 text-sm mt-12">
        <p>Designed for simplicity and privacy.</p>
    </div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<script>
    // --- 界面交互逻辑 (新增) ---
    // 监听压缩文件选择，更新提示文本
    document.getElementById('filesToZip').addEventListener('change', function(e) {
        const count = e.target.files.length;
        const label = document.getElementById('zipFileCount');
        label.textContent = count > 0 ? `已选择 ${count} 个文件` : '(支持多选)';
        label.classList.toggle('text-primary', count > 0);
    });

    // 监听解压文件选择，更新提示文本
    document.getElementById('fileToUnzip').addEventListener('change', function(e) {
        const fileName = e.target.files[0]?.name;
        const label = document.getElementById('unzipFileName');
        label.textContent = fileName ? fileName : '(仅限一个文件)';
        label.classList.toggle('text-secondary', fileName);
        // 如果重新选择了文件，隐藏之前的结果列表
        document.getElementById('unzipResultWrapper').classList.add('hidden');
    });


    // --- 核心逻辑 (功能未变，仅适配了新的ID和样式) ---

    // 压缩逻辑
    async function compressFiles() {
        const fileInput = document.getElementById('filesToZip');
        const files = fileInput.files;

        if (files.length === 0) {
            // 使用更现代的弹窗可以用 SweetAlert2，这里为了简单仍用 alert，但你可以自己替换
            alert("⚠️ 请先选择要压缩的文件！");
            return;
        }

        const btn = event.currentTarget;
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i> 处理中...';
        btn.disabled = true;

        const zip = new JSZip();
        for (let i = 0; i < files.length; i++) {
            zip.file(files[i].name, files[i]);
        }

        try {
            const content = await zip.generateAsync({type: "blob"});
            saveAs(content, `archive_${new Date().getTime()}.zip`); // 加上时间戳让文件名不重复
        } catch (e) {
            console.error(e);
            alert("❌ 压缩失败，请重试。");
        } finally {
            btn.innerHTML = originalText;
            btn.disabled = false;
        }
    }

    // 解压逻辑
    async function decompressFile() {
        const fileInput = document.getElementById('fileToUnzip');
        const file = fileInput.files[0];
        const resultWrapper = document.getElementById('unzipResultWrapper');
        const resultDiv = document.getElementById('unzipResult');
        resultDiv.innerHTML = "";

        if (!file) {
            alert("⚠️ 请先选择一个 ZIP 文件！");
            return;
        }
        
        const btn = event.currentTarget;
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i> 读取中...';
        btn.disabled = true;

        try {
            const zip = new JSZip();
            const zipContent = await zip.loadAsync(file);
            
            let listHtml = '<ul class="w-full">';
            let fileCount = 0;

            zipContent.forEach(function (relativePath, zipEntry) {
                if (!zipEntry.dir) {
                    fileCount++;
                    // 注意这里：我更新了生成列表的 HTML，使用了 Tailwind 类名来美化
                    listHtml += `
                        <li class="flex justify-between items-center py-3 px-3 hover:bg-gray-100 transition duration-150">
                            <div class="flex items-center overflow-hidden">
                                <i class="fa-regular fa-file text-gray-400 mr-3"></i>
                                <span class="text-sm text-gray-700 truncate" title="${zipEntry.name}">${zipEntry.name}</span>
                            </div>
                            <button class="text-sm text-secondary hover:text-emerald-700 font-medium py-1 px-3 border border-secondary rounded hover:bg-green-50 transition ml-2 shrink-0" 
                                onclick="downloadOneFile('${relativePath.replace(/'/g, "\\'")}')">
                                <i class="fa-solid fa-download"></i> 下载
                            </button>
                        </li>`;
                }
            });
            listHtml += '</ul>';

            if (fileCount === 0) {
                 resultDiv.innerHTML = '<p class="text-center text-gray-500 py-4">压缩包里似乎没有文件。</p>';
            } else {
                 resultDiv.innerHTML = listHtml;
            }
            resultWrapper.classList.remove('hidden'); // 显示结果区域
            window.currentZip = zip;

        } catch (e) {
            console.error(e);
            alert("❌ 这不是一个有效的 ZIP 文件或文件已损坏。");
            resultWrapper.classList.add('hidden');
        } finally {
             btn.innerHTML = originalText;
             btn.disabled = false;
        }
    }

    async function downloadOneFile(filename) {
        if(!window.currentZip) return;
        const file = window.currentZip.file(filename);
        if(file) {
            const blob = await file.async("blob");
            // 处理可能包含路径的文件名，只取最后一部分
            const safeFileName = filename.split('/').pop();
            saveAs(blob, safeFileName);
        }
    }
</script>

</body>
</html>