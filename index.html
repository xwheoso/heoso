<!DOCTYPE html>
<html lang="zh-CN" class="antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZIP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/jpeg" href="favicon.jpg">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', '"Segoe UI"', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'],
                    },
                    colors: {
                        apple: {
                            bg: '#fbfbfd', // Apple 官网常见的浅灰背景
                            card: '#ffffff',
                            text: '#1d1d1f', // 深灰文本，非纯黑
                            subtext: '#86868b', // 次级文本
                            blue: '#0071e3', // Apple 交互蓝
                            blueHover: '#0077ED',
                        }
                    },
                    boxShadow: {
                        // 极致柔和的 Apple 风格悬浮阴影
                        'apple-card': '0 20px 40px -15px rgba(0,0,0,0.05), 0 0 20px -5px rgba(0,0,0,0.02)',
                        'apple-hover': '0 30px 60px -15px rgba(0,0,0,0.1), 0 0 30px -5px rgba(0,0,0,0.04)',
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: 0, transform: 'translateY(20px)' },
                            '100%': { opacity: 1, transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            /* 美化的上传区域基础样式 */
            .upload-zone-base {
                @apply relative h-48 rounded-[24px] bg-gray-50 border border-transparent transition-all duration-300 ease-out group-hover:bg-[#f5f5f7] group-hover:border-gray-200 overflow-hidden;
            }
            /* 交互按钮基础样式 */
            .apple-button {
                @apply w-full py-4 rounded-full bg-apple-blue text-white font-medium text-[17px] transition-all duration-300 ease-out hover:bg-apple-blueHover hover:shadow-lg hover:scale-[1.01] active:scale-[0.98] disabled:opacity-70 disabled:cursor-not-allowed;
            }
        }
        /* 全局背景色 */
        body { background-color: #fbfbfd; }
    </style>
</head>
<body class="min-h-screen py-20 px-4 font-sans text-apple-text selection:bg-apple-blue/20">

<div class="container mx-auto max-w-6xl">
    
    <div class="text-center mb-8 animate-fade-in-up">
        <h1 class="text-5xl md:text-6xl font-semibold tracking-tight mb-4 bg-clip-text text-transparent bg-gradient-to-b from-apple-text to-gray-600">
            ZIP(Developped by WX)
        </h1>
        <!-- <p class="text-xl text-apple-subtext max-w-2xl mx-auto leading-relaxed font-light">
            极简设计，极致安全。所有文件操作均在您的浏览器本地完成，无需上传。
        </p> -->
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12 px-4 md:px-0">

        <div class="group bg-apple-card rounded-[32px] p-8 md:p-10 shadow-apple-card transition-all duration-500 hover:shadow-apple-hover hover:-translate-y-1 animate-fade-in-up" style="animation-delay: 0.1s;">
            <div class="mb-8">
                <div class="w-12 h-12 rounded-2xl bg-blue-50 text-apple-blue flex items-center justify-center text-2xl mb-6 transition-transform duration-300 group-hover:scale-110 group-hover:rotate-[-5deg]">
                    <i class="fa-solid fa-box-archive"></i>
                </div>
                <h2 class="text-3xl font-semibold mb-2">创建压缩包</h2>
                <p class="text-apple-subtext">选择多个文件，打包下载。</p>
            </div>

            <div class="space-y-8">
                <label class="upload-zone-base flex flex-col items-center justify-center cursor-pointer group/upload">
                    <div class="absolute inset-0 bg-gradient-to-tr from-blue-50/50 to-transparent opacity-0 group-hover/upload:opacity-100 transition-opacity duration-500"></div>
                    
                    <div class="relative z-10 flex flex-col items-center transition-transform duration-300 group-hover/upload:-translate-y-1">
                        <i class="fa-solid fa-cloud-arrow-up text-5xl text-gray-300 mb-4 transition-colors duration-300 group-hover/upload:text-apple-blue animate-pulse-slow"></i>
                        <span class="text-lg font-medium text-gray-600 group-hover/upload:text-apple-text">点击选择文件</span>
                        <span id="zipFileCount" class="text-sm text-apple-subtext mt-2 transition-all">(支持多选)</span>
                    </div>
                    <input id="filesToZip" type="file" multiple class="hidden" />
                </label>
                
                <button onclick="compressFiles()" id="compressBtn" class="apple-button">
                    生成并下载 ZIP
                </button>
            </div>
        </div>

        <div class="group bg-apple-card rounded-[32px] p-8 md:p-10 shadow-apple-card transition-all duration-500 hover:shadow-apple-hover hover:-translate-y-1 animate-fade-in-up" style="animation-delay: 0.2s;">
             <div class="mb-8">
                <div class="w-12 h-12 rounded-2xl bg-green-50 text-emerald-500 flex items-center justify-center text-2xl mb-6 transition-transform duration-300 group-hover:scale-110 group-hover:rotate-[5deg]">
                    <i class="fa-solid fa-box-open"></i>
                </div>
                <h2 class="text-3xl font-semibold mb-2">解压文件</h2>
                <p class="text-apple-subtext">读取 ZIP 内容并提取文件。</p>
            </div>

            <div class="space-y-8">
                <label class="upload-zone-base flex flex-col items-center justify-center cursor-pointer group/upload">
                    <div class="absolute inset-0 bg-gradient-to-tr from-green-50/50 to-transparent opacity-0 group-hover/upload:opacity-100 transition-opacity duration-500"></div>

                    <div class="relative z-10 flex flex-col items-center transition-transform duration-300 group-hover/upload:-translate-y-1">
                        <i class="fa-solid fa-file-zipper text-5xl text-gray-300 mb-4 transition-colors duration-300 group-hover/upload:text-emerald-500 animate-pulse-slow"></i>
                        <span class="text-lg font-medium text-gray-600 group-hover/upload:text-apple-text">点击选择 .zip 文件</span>
                        <span id="unzipFileName" class="text-sm text-apple-subtext mt-2 truncate max-w-[200px] transition-all">(仅限一个文件)</span>
                    </div>
                    <input id="fileToUnzip" type="file" accept=".zip" class="hidden" />
                </label>

                <button onclick="decompressFile()" id="decompressBtn" class="apple-button bg-emerald-500 hover:bg-emerald-600">
                     读取文件列表
                </button>

                <div id="unzipResultWrapper" class="hidden transition-all duration-500 ease-in-out">
                    <h3 class="text-sm font-semibold text-apple-subtext mb-4 uppercase tracking-wider pl-2">
                        文件列表
                    </h3>
                    <div id="unzipResult" class="bg-gray-50/80 rounded-3xl p-2 max-h-80 overflow-y-auto shadow-inner backdrop-blur-sm">
                        </div>
                </div>
            </div>
        </div>

    </div>
    
    <div class="text-center text-apple-subtext text-sm mt-24 mb-12 animate-fade-in-up" style="animation-delay: 0.3s;">
        <p class="mb-4 font-light">Designed for simplicity and privacy.</p>
        <a href="mailto:xwheoso@gmail.com" class="inline-flex items-center py-2 px-4 rounded-full bg-white shadow-sm hover:shadow-md text-apple-text transition-all duration-300 hover:scale-105 hover:text-apple-blue group">
            <i class="fa-regular fa-envelope mr-2 text-gray-400 group-hover:text-apple-blue transition-colors"></i>
            <span class="font-medium">联系开发者</span>
        </a>
    </div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<script>
    // --- 界面交互逻辑 (增强版) ---
    document.getElementById('filesToZip').addEventListener('change', function(e) {
        const count = e.target.files.length;
        const label = document.getElementById('zipFileCount');
        if (count > 0) {
            label.textContent = `已准备 ${count} 个文件`;
            label.classList.add('text-apple-blue', 'font-medium');
        } else {
            label.textContent = '(支持多选)';
            label.classList.remove('text-apple-blue', 'font-medium');
        }
    });

    document.getElementById('fileToUnzip').addEventListener('change', function(e) {
        const fileName = e.target.files[0]?.name;
        const label = document.getElementById('unzipFileName');
        if (fileName) {
            label.textContent = fileName;
            label.classList.add('text-emerald-600', 'font-medium');
        } else {
            label.textContent = '(仅限一个文件)';
            label.classList.remove('text-emerald-600', 'font-medium');
        }
        document.getElementById('unzipResultWrapper').classList.add('hidden');
    });


    // --- 核心逻辑 (逻辑不变，更新了UI反馈和生成的HTML结构) ---

    async function compressFiles() {
        const fileInput = document.getElementById('filesToZip');
        const files = fileInput.files;
        const btn = document.getElementById('compressBtn');

        if (files.length === 0) {
            // 简单的抖动提示 (这里简化处理，实际可以用 CSS动画)
            btn.classList.add('bg-red-500');
            setTimeout(() => btn.classList.remove('bg-red-500'), 200);
            alert("请先选择需要压缩的文件。");
            return;
        }

        const originalText = btn.innerHTML;
        // 苹果风格的加载提示
        btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin mr-2"></i> 正在打包...';
        btn.disabled = true;

        const zip = new JSZip();
        for (let i = 0; i < files.length; i++) {
            zip.file(files[i].name, files[i]);
        }

        try {
            const content = await zip.generateAsync({type: "blob"});
            saveAs(content, `Archive.zip`);
        } catch (e) {
            console.error(e);
            alert("压缩失败，请重试。");
        } finally {
            btn.innerHTML = originalText;
            btn.disabled = false;
        }
    }

    async function decompressFile() {
        const fileInput = document.getElementById('fileToUnzip');
        const file = fileInput.files[0];
        const resultWrapper = document.getElementById('unzipResultWrapper');
        const resultDiv = document.getElementById('unzipResult');
        const btn = document.getElementById('decompressBtn');
        
        resultDiv.innerHTML = "";

        if (!file) {
            btn.classList.add('bg-red-500');
            setTimeout(() => btn.classList.remove('bg-red-500'), 200);
            alert("请先选择一个 ZIP 文件。");
            return;
        }
        
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin mr-2"></i> 正在解析...';
        btn.disabled = true;

        try {
            const zip = new JSZip();
            const zipContent = await zip.loadAsync(file);
            
            // 使用 flex 布局的列表，更像是一个个小卡片
            let listHtml = '<div class="flex flex-col gap-2 p-2">';
            let fileCount = 0;

            zipContent.forEach(function (relativePath, zipEntry) {
                if (!zipEntry.dir) {
                    fileCount++;
                    // 重新设计的文件列表项：圆角、白色背景、微阴影、悬停放大
                    listHtml += `
                        <div class="group/item flex justify-between items-center p-4 bg-white rounded-[20px] shadow-sm border border-gray-100/50 transition-all duration-200 hover:shadow-md hover:scale-[1.01] hover:border-blue-100">
                            <div class="flex items-center overflow-hidden mr-4">
                                <div class="w-10 h-10 rounded-full bg-gray-100 text-gray-400 flex items-center justify-center mr-4 group-hover/item:bg-blue-50 group-hover/item:text-apple-blue transition-colors">
                                    <i class="fa-regular fa-file text-lg"></i>
                                </div>
                                <span class="text-[15px] font-medium text-apple-text truncate" title="${zipEntry.name}">${zipEntry.name}</span>
                            </div>
                            <button class="opacity-0 group-hover/item:opacity-100 transition-all duration-200 focus:opacity-100 text-sm font-medium text-apple-blue bg-blue-50 hover:bg-apple-blue hover:text-white py-2 px-5 rounded-full shrink-0" 
                                onclick="downloadOneFile('${relativePath.replace(/'/g, "\\'")}')">
                                下载
                            </button>
                        </div>`;
                }
            });
            listHtml += '</div>';

            if (fileCount === 0) {
                 resultDiv.innerHTML = '<div class="text-center text-apple-subtext py-8">压缩包是空的或只包含文件夹。</div>';
            } else {
                 resultDiv.innerHTML = listHtml;
            }
            resultWrapper.classList.remove('hidden'); 
            // 简单的入场动画
            resultWrapper.style.opacity = 0;
            resultWrapper.style.transform = 'translateY(10px)';
            setTimeout(() => {
                resultWrapper.style.opacity = 1;
                resultWrapper.style.transform = 'translateY(0)';
            }, 50);

            window.currentZip = zip;

        } catch (e) {
            console.error(e);
            alert("无法解析文件，请确保选择的是有效的 ZIP 格式。");
            resultWrapper.classList.add('hidden');
        } finally {
             btn.innerHTML = originalText;
             btn.disabled = false;
        }
    }

    async function downloadOneFile(filename) {
        if(!window.currentZip) return;
        const file = window.currentZip.file(filename);
        if(file) {
            const blob = await file.async("blob");
            const safeFileName = filename.split('/').pop();
            saveAs(blob, safeFileName);
        }
    }
</script>

</body>
</html>